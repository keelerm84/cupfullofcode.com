<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Performing Controlled PHP Refactorings in Emacs | Cup Full of Code</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <link rel="alternative" href="/atom.xml" title="Cup Full of Code" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
    <script src="/js/jquery.min.js" type="text/javascript"></script>

    <script src="/js/jquery.dropotron.min.js" type="text/javascript"></script>

    <script src="/js/skel.min.js" type="text/javascript"></script>

    <script src="/js/skel-layers.min.js" type="text/javascript"></script>

    <script src="/js/init.js" type="text/javascript"></script>

    <noscript>
        <link rel="stylesheet" href="/css/skel.css" type="text/css">

        <link rel="stylesheet" href="/css/style.css" type="text/css">

        <link rel="stylesheet" href="/css/style-desktop.css" type="text/css">

    </noscript>
    <!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
</head>

<body class="no-sidebar">
  <div id="container">
    <div id="wrap">
      <div id="header-wrapper" class="wrapper">
    <div id="header">

        <!-- Logo -->
        <div id="logo">
            <h1><a href="index.html">Cup Full of Code</a></h1>
            <p>The personal site of Matthew M. Keeler</p>
        </div>

        <!-- Nav -->
        <nav id="nav">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/portfolio">Portfolio</a></li>
                <li><a href="/resume">Resume</a></li>
                <li><a href="/archives">Blog</a></li>
            </ul>
        </nav>

    </div>
</div>

      <div class="outer">
        <section><div class="wrapper style2">
    <div class="section-title">
        <a href="/blog/2014/09/21/php-refactor-mode/" class="article-date">
  <time datetime="2014-09-21T04:00:00.000Z" itemprop="datePublished">Sep 21 2014</time>
</a>
    </div>
    <div id="main" class="container">
        <article id="post-php-refactor-mode" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
            
  
    <h1 class="article-title" itemprop="name">
      Performing Controlled PHP Refactorings in Emacs
    </h1>
  

        </header>
    
        <div class="article-entry" itemprop="articleBody">
            
                <p>By day, I work as a PHP developer at
<a href="http://researchsquare.com" target="_blank" rel="external">Research Square</a>.  My time is spent developing new
functionality for the RS suite of products.  This may include working in
greenfield code bases or extending our legacy products.  In either case, dozens
of times a day, I find myself performing various code refactorings.<a id="more"></a></p>
<h1 id="The_Problem">The Problem</h1>
<p>Refactoring code is imperative to maintaining a healthy code base.  Technical
debt can quickly pile up in even a moderately sized code base, let alone across
a system flirting with a million lines of code.  It is the job of any developer
to ensure code is refactored whenever the existing design begins to offer
friction.  It is absolutely critical that these refactorings in no way alter
the behavior of the system.</p>
<p>In Martin Fowler’s book,
<a href="http://martinfowler.com/books/refactoring.html" target="_blank" rel="external">Refactoring: Improving the Design of Existing Code</a>,
he discusses a variety of common refactoring patterns, outlining the necessary
steps to execute these methods safely and efficiently.  While the steps given
are excellent, to perform them manually is not only tedious, but horribly error
prone.</p>
<p>While some IDEs provide automated support for such refactorings, text editors
like vim and emacs do not.  As a long time user of both (with emacs being my
favored editor these days), I needed to look elsewhere to achieve this kind of
support.</p>
<h1 id="The_Solution">The Solution</h1>
<p>During my search for a decent solution, I came across the
<a href="https://github.com/QafooLabs/php-refactoring-browser" target="_blank" rel="external">php-refactoring-browser</a>
by QafooLabs.  The php-refactoring-browser is a command-line tool, written in
PHP, that can perform a variety of refactoring methods on a particular file.
Following the guidelines from Fowler’s books, each refactoring is a series of
simple steps that ensure the system’s behavior is left unaltered.</p>
<h1 id="A_New_Problem">A New Problem</h1>
<p>I tried out this tool for a while and absolutely loved the results.  The
php-refactoring-browser performed remarkably well and provided me with a
solution I had desperately been seeking.  But alas, there was a problem.</p>
<p>While I love the command-line, using the php-refactoring-browser
directly was time consuming and frankly, quite annoying.  Each refactoring
method requires a decent number of arguments, including the file and associated
line numbers to operate on.</p>
<p>For example, in order to convert a local variable to an instance variable, the
command would look something like</p>
<figure class="highlight bash"><pre><div class="line">php refactor.phar convert-local-to-instance-variable FileToRefactor.php <span class="number">17</span> <span class="variable">$aLocalVariableName</span></div></pre></figure>    

<p>Further more, the php-refactoring-browser will only generate a patch of the
necessary changes.  It will not modify the files inline.  Not only was I
responsible for providing all of these input parameters, I also had to manually
apply the patch, and then refresh the file in my editor.</p>
<h1 id="A_New_Solution">A New Solution</h1>
<p>Being an enthusiastic user of emacs, I knew there had to be a better way.  So I
set out to create a minor mode for working with the php-refactoring-browser.
<a href="https://github.com/keelerm84/php-refactor-mode.el" target="_blank" rel="external">php-refactor-mode</a> is the
result.</p>
<p>This minor mode allows you to quickly perform a variety of the refactoring
methods available through the php-refactoring-browser with a few short
keystrokes.  Since emacs already knows the path to the file and any line
numbers, I was relieved from ever having to think about that again.  And as for
things emacs doesn’t know, such as the new method name I might want to use, it
can simply prompt me for it.</p>
<p>Furthermore, the minor mode will automatically apply the resulting patch from
the php-refactoring-browser and re-read the file contents so you can focus on
the work at hand, never breaking your flow to think about the steps for
performing these refactorings.</p>
<p>As a final benefit, each refactoring can be undone as one atomic operation.  So
if you decide you don’t like the results, press <code>C-_</code> and proceed as if it never
happened.</p>
<h2 id="Let’s_See_It_In_Action">Let’s See It In Action</h2>
<p>Below is a video demoing some of the supported refactoring methods provided by
php-refactor-mode.  If you’re an emacs user who writes PHP, I hope you’ll
consider giving it a try.  The package is available for installation on melpa
and of course the source code is available on github.</p>
<iframe width="100%" height="500" src="//www.youtube.com/embed/J9lbdtdsPi4" frameborder="0" allowfullscreen></iframe>

<h1 id="vim_Users">vim Users</h1>
<p>If you’re a vim user, then you’re in luck.
<a href="https://github.com/vim-php/vim-php-refactoring" target="_blank" rel="external">vim-php-refactoring</a> is a vim
plugin that provides the same type of support.  In fact, it was a great source
of inspiration for my emacs package.  Thanks for paving the way!</p>

        
        </div>
    </div>
</article>

<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>


    </div>
</div>
</section>
      </div>
      <!-- Footer -->
<div id="footer-wrapper" class="wrapper">
    <div class="section-title">Links of interest</div>
    <div id="footer" class="container">
        <div class="row oneandhalf">
            <div class="12u">

                <section class="feature-list small">
                    <div class="row">
                        <div class="3u">
                            <section>
                                <h3 class="icon fa-envelope">Email</h3>
                                <p>
                                <a href="#">keelerm@tortugas-llc.com</a>
                                </p>
                            </section>
                            <section>
                                <h3 class="icon fa-rss">Subscribe</h3>
                                <p>
                                <a href="/atom.xml">Atom Feed</a>
                                </p>
                            </section>
                        </div>
                        <div class="3u">
                            <section>
                                <h3 class="icon fa-comment">Social</h3>
                                <p>
                                <a href="#">@keelerm84</a><br />
                                <a href="#">github.com/keelerm84</a><br />
                                <a href="#">youtube.com/user/keelerm84ify</a>
                                </p>
                            </section>
                        </div>
                        <div class="3u">
                            <section>
                                <h3 class="icon fa-tag">Tags</h3>
                                
  <div class="widget-wrap">
    <p>
    <a class="tag-link" href="/tags/automation/">automation</a>, <a class="tag-link" href="/tags/elisp/">elisp</a>, <a class="tag-link" href="/tags/emacs/">emacs</a>, <a class="tag-link" href="/tags/logic/">logic</a>, <a class="tag-link" href="/tags/org-mode/">org-mode</a>, <a class="tag-link" href="/tags/php/">php</a>, <a class="tag-link" href="/tags/projectile/">projectile</a>, <a class="tag-link" href="/tags/refactoring/">refactoring</a>, <a class="tag-link" href="/tags/screen/">screen</a>, <a class="tag-link" href="/tags/snippets/">snippets</a>, <a class="tag-link" href="/tags/utilities/">utilities</a>, <a class="tag-link" href="/tags/zsh/">zsh</a>
    </p>
  </div>


                            </section>
                        </div>
                        <div class="3u">
                            <section>
                                <h3 class="icon fa-folder-open">Categories</h3>
                                
    <p>
    <a class="category-link" href="/categories/Emacs/">Emacs</a>, <a class="category-link" href="/categories/Emacs/PHP/">PHP</a>, <a class="category-link" href="/categories/Programming/">Programming</a>, <a class="category-link" href="/categories/Utilities/">Utilities</a>
    </p>


                            </section>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        <hr />
        <header class="style1">
            <h2>There is no system but GNU, and Linux is one of its kernels.</h2>
            <p>&mdash; St. IGNUcius</p>
        </header>
    </div>
</div>

    </div>
    
<script>
  var disqus_shortname = 'cupfullofcode';
  
  var disqus_url = 'http://cupfullofcode.com/blog/2014/09/21/php-refactor-mode/';
  
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55725869-1', 'auto');
  ga('send', 'pageview');

</script>
  </div>
</body>
</html>
