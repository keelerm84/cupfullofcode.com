<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=HandheldFriendly content="True"><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=generator content="Hugo 0.98.0"><link rel="shortcut icon" href=https://cdn.jsdelivr.net/gh/dsrkafuu/dsr-cdn-main@1/images/favicons/dsrca.ico><title>Generate Daily Messages With Org Journal - Cup Full of Code</title><meta name=author content="Matthew M. Keeler"><meta name=description content="Automating standup notes for fun and profit"><meta name=keywords content="org-mode,emacs,elisp"><meta property="og:title" content="Generate Daily Messages With Org Journal"><meta name=twitter:title content="Generate Daily Messages With Org Journal"><meta property="og:type" content="article"><meta property="og:url" content="https://cupfullofcode.com/blog/2013/11/17/generate-daily-messages-with-org-journal/"><meta property="og:description" content="Automating standup notes for fun and profit"><meta name=twitter:description content="Automating standup notes for fun and profit"><meta name=twitter:card content="summary"><meta property="article:published_time" content="2013-11-17T15:38:00+00:00"><meta property="article:modified_time" content="2013-11-17T15:38:00+00:00"><style>@media(prefers-color-scheme:dark){body[data-theme=auto] img{filter:brightness(60%)}}body[data-theme=dark] img{filter:brightness(60%)}</style><link rel=stylesheet href=https://cupfullofcode.com/assets/css/fuji.min.css><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-55725869-1")</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-55725869-1"></script></head><body data-theme=auto data-theme-auto=false><script data-cfasync=false>var fujiThemeData=localStorage.getItem("fuji_data-theme");fujiThemeData?fujiThemeData!=="auto"&&document.body.setAttribute("data-theme",fujiThemeData==="dark"?"dark":"light"):localStorage.setItem("fuji_data-theme","auto")</script><header><div class="container-lg clearfix"><div class="col-12 header"><a class=title-main href=https://cupfullofcode.com>Cup Full of Code</a>
<span class=title-sub>The personal site of Matthew M. Keeler</span></div></div></header><main><div class="container-lg clearfix"><div class="col-12 col-md-9 float-left content"><article><h2 class="post-item post-title"><a href=https://cupfullofcode.com/blog/2013/11/17/generate-daily-messages-with-org-journal/>Generate Daily Messages With Org Journal</a></h2><div class="post-item post-meta"><span><i class="iconfont icon-today-sharp"></i>&nbsp;2013-11-17</span>
<span><i class="iconfont icon-file-tray-sharp"></i>&nbsp;1025 words</span>
<span><i class="iconfont icon-time-sharp"></i>&nbsp;5 minutes</span>
<span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href=https://cupfullofcode.com/tags/org-mode>org-mode</a>&nbsp;<a href=https://cupfullofcode.com/tags/emacs>emacs</a>&nbsp;<a href=https://cupfullofcode.com/tags/elisp>elisp</a>&nbsp;</span></div><div class="post-content markdown-body"><p>One of the requirements of my job is to send out a daily message. This message
should summarize what I did the day before, and what I hope to accomplish for
the current day. At first, I would spend my day jumping from task to task, and
then the next morning, I would rack my brain to make sure I included all the
things I worked on.</p><p>It didn&rsquo;t take long to realize that this was no way to live. I definitely
needed a better solution. So I started looking around.</p><h2 id=org-journal>Org Journal</h2><p>After hunting around for a bit, I came across Org Journal. It is a fantastic
package for, as the name implies, writing journal entries. And since it&rsquo;s built
on top of Org Mode, I knew I had to give it a try.</p><p>Once installed and configured, I can press, in my case, C-x j, and this will
either start a new journal entry if one doesn&rsquo;t already exist, or open an
existing one. Each time a new entry is added, org-journal inserts a second
level heading in the document, and stamps it with the time the entry was added.</p><p>This was definitely a productivity win for me, and so I settled on it as my
tool of choice.</p><h2 id=scratching-an-itch>Scratching An Itch</h2><p>Even though org-journal was assisting me in remembering everything I did on the
previous day, I still had to format the entries into a suitable format and send
them off to my boss. Accomplishing this was a multi-step process which I
quickly grew tired of. I had to:</p><ol><li>Call M-x calendar and navigate to the previous day</li><li>Press j to open that day&rsquo;s journal entry</li><li>C-x h to copy the entire entry</li><li>C-x b <em>scratch</em> to switch over to my scratch buffer</li><li>C-y to paste the journal contents in</li><li>Remove any additional notes I had, strip out the top level headers and time stamps, and then add my plan for the current day.</li></ol><p>What a bunch of nonsense! I certainly wasn&rsquo;t going to do that 5 days a week for
the rest of my career.</p><h2 id=elisp-to-the-rescue>Elisp to the Rescue</h2><p>So naturally, I did what any Emacs user would do: I wrote some lisp. Before we
get into the code, I should warn you about something. I&rsquo;m still pretty new to
lisp. If you&rsquo;re an old hat at this stuff, I&rsquo;m sure there are better ways to
accomplish what I&rsquo;m doing. And I would LOVE to hear about them. Please feel
free to comment!</p><p>Disclaimer aside, let&rsquo;s get into the code.</p><h3 id=what-was-yesterday>What Was Yesterday</h3><p>The first thing I needed to accomplish was determining the date of the prior
day. Like most people (I hope), I only work 5 days a week. So simply grabbing
yesterday&rsquo;s date wasn&rsquo;t going to work. Instead, I need to keep subtracting a
day&rsquo;s worth of time from the current day, until I reached some time period that
fell between Monday and Friday.</p><p>That lead me to:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp><span style=display:flex><span>(defun my/org-find-previous-workday ()
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let*</span> ((time (time-subtract (current-time) (seconds-to-time <span style=color:#ae81ff>86400</span>)))
</span></span><span style=display:flex><span>         (workdays <span style=color:#f92672>&#39;</span>(<span style=color:#e6db74>&#34;Monday&#34;</span> <span style=color:#e6db74>&#34;Tuesday&#34;</span> <span style=color:#e6db74>&#34;Wednesday&#34;</span> <span style=color:#e6db74>&#34;Thursday&#34;</span> <span style=color:#e6db74>&#34;Friday&#34;</span>)))
</span></span><span style=display:flex><span>    (while (<span style=color:#a6e22e>not</span> (<span style=color:#a6e22e>member</span> (format-time-string <span style=color:#e6db74>&#34;%A&#34;</span> time) workdays))
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>setq</span> time (time-subtract time (seconds-to-time <span style=color:#ae81ff>86400</span>))))
</span></span><span style=display:flex><span>    time))</span></span></code></pre></div><h3 id=grab-the-tasks>Grab The Tasks</h3><p>Once I knew the previous working day&rsquo;s date, I needed to grab the journal
entry&rsquo;s content. Since I include notes and other references for each entry, and
this email is supposed to be succinct, using the entire journal entry wasn&rsquo;t
sufficient. Instead, I needed to strip out just the second level headings,
which include short summaries of what I&rsquo;m working on.</p><p>I wrote three functions to handle this, which are included below. The results
of these three functions is to return a list of all the headers in the org file
with a level I specified. If I don&rsquo;t specify a level, it will return all header
levels.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp><span style=display:flex><span>(defun my/org-should-include-current (level)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>progn</span>
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if</span> (and
</span></span><span style=display:flex><span>         (outline-on-heading-p)
</span></span><span style=display:flex><span>         (or
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>eq</span> <span style=color:#66d9ef>nil</span> level) (<span style=color:#a6e22e>eq</span> level (org-outline-level))))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>t</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>nil</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(defun my/org-get-current-header ()
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>progn</span>
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>setq</span> beg (point))
</span></span><span style=display:flex><span>    (outline-end-of-heading)
</span></span><span style=display:flex><span>    (buffer-substring-no-properties beg (point))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(defun my/org-outline-headings-to-list (level)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>setq</span> headings <span style=color:#f92672>&#39;</span>())
</span></span><span style=display:flex><span>  (show-all)
</span></span><span style=display:flex><span>  (goto-char (point-min))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if</span> (my/org-should-include-current level)
</span></span><span style=display:flex><span>      (add-to-list <span style=color:#e6db74>&#39;headings</span> (my/org-get-current-header) <span style=color:#66d9ef>t</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (while (outline-next-heading)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if</span> (my/org-should-include-current level)
</span></span><span style=display:flex><span>        (add-to-list <span style=color:#e6db74>&#39;headings</span> (my/org-get-current-header) <span style=color:#66d9ef>t</span>)))
</span></span><span style=display:flex><span>  headings)</span></span></code></pre></div><h3 id=generating-the-message>Generating The Message</h3><p>At this point, I had all the data I needed to quickly generate my scrum
message. All that was left was to hook it together, open a temp buffer with the
formatted results, and then start filling in the current day&rsquo;s goals.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp><span style=display:flex><span>(defun my/org-outline-create-scrum-message ()
</span></span><span style=display:flex><span>  (interactive)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let*</span> ((previous (my/org-find-previous-workday)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>setq</span> journal-file (concat org-journal-dir (format-time-string <span style=color:#e6db74>&#34;%Y%m%d&#34;</span> previous)))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if</span> (file-exists-p journal-file)
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>progn</span>
</span></span><span style=display:flex><span>          (switch-to-buffer (find-file-noselect journal-file))
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>setq</span> headings (my/org-outline-headings-to-list <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>          (switch-to-buffer <span style=color:#e6db74>&#34;*daily scrum*&#34;</span>)
</span></span><span style=display:flex><span>          (erase-buffer)
</span></span><span style=display:flex><span>          (insert <span style=color:#e6db74>&#34;* Yesterday\n&#34;</span>)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>mapcar</span> (lambda(element)
</span></span><span style=display:flex><span>                    (insert (replace-regexp-in-string <span style=color:#e6db74>&#34;^** ..... &#34;</span> <span style=color:#e6db74>&#34;  - &#34;</span> element) <span style=color:#e6db74>&#34;\n&#34;</span>)) headings)
</span></span><span style=display:flex><span>          (insert <span style=color:#e6db74>&#34;\n* Today\n  - &#34;</span>)
</span></span><span style=display:flex><span>          (org-mode)
</span></span><span style=display:flex><span>          (show-all)))))</span></span></code></pre></div><h2 id=future-expansion>Future Expansion</h2><p>I have been using this method for the last couple of weeks to much success. It
has saved me a ton of time, and has helped ensure that I account for every task
I worked on during the previous day.</p><p>There are a few things I would like to improve. The most obvious next step is
to hook up gnus to my work email and generate this message in an actual email
buffer. Then, once I&rsquo;m finished typing, I can just send it off directly from
Emacs instead of copy and pasting it into my mail client.</p><p>The other thing I need to handle is skipped dates. If I take a vacation day, or
there is a holiday, this code will just fail to generate a message template for
me. It only goes back one day and then calls it quits after that. It wouldn&rsquo;t
take much to modify it to keep searching until it finds a day with an entry. I
just haven&rsquo;t gotten around to it yet.</p><p>As I mentioned before, I&rsquo;m sure the code could be improved. I would love to
hear feedback from the community on what I could do better. Lisp is still
pretty new to me, but I&rsquo;ve been having a blast learning it.</p><p>For those interested in seeing the code all in one place, or checking out the
rest of my configuration, you can see it on GitHub.</p><p>Thanks, and happy coding!</p></div></article></div><aside class="col-12 col-md-3 float-left sidebar"><div class="sidebar-item sidebar-pages"><h3>Pages</h3><ul><li><a href=https://cupfullofcode.com/>Home</a></li><li><a href=https://cupfullofcode.com/about/>About</a></li><li><a href=https://cupfullofcode.com/blog/>Blog</a></li><li><a href=https://cupfullofcode.com/search/>Search</a></li><li><a href=https://cupfullofcode.com/index.xml>RSS</a></li></ul></div><div class="sidebar-item sidebar-links"><h3>Links</h3><ul><li><a href=https://github.com/keelerm84 target=_blank><span>GitHub</span></a></li><li><a href=https://twitter.com/keelerm84 target=_blank><span>Twitter</span></a></li></ul></div><div class="sidebar-item sidebar-tags"><h3>Tags</h3><div><span><a href=https://cupfullofcode.com/tags/automation/>automation</a></span>
<span><a href=https://cupfullofcode.com/tags/devops/>devops</a></span>
<span><a href=https://cupfullofcode.com/tags/elisp/>elisp</a></span>
<span><a href=https://cupfullofcode.com/tags/emacs/>emacs</a></span>
<span><a href=https://cupfullofcode.com/tags/github/>github</a></span>
<span><a href=https://cupfullofcode.com/tags/hugo/>hugo</a></span>
<span><a href=https://cupfullofcode.com/tags/logic/>logic</a></span>
<span><a href=https://cupfullofcode.com/tags/org-mode/>org-mode</a></span>
<span><a href=https://cupfullofcode.com/tags/php/>php</a></span>
<span><a href=https://cupfullofcode.com/tags/projectile/>projectile</a></span>
<span><a href=https://cupfullofcode.com/tags/refactoring/>refactoring</a></span>
<span><a href=https://cupfullofcode.com/tags/screen/>screen</a></span>
<span><a href=https://cupfullofcode.com/tags/snippets/>snippets</a></span>
<span><a href=https://cupfullofcode.com/tags/utilities/>utilities</a></span>
<span><a href=https://cupfullofcode.com/tags/vim/>vim</a></span>
<span><a href=https://cupfullofcode.com/tags/zsh/>zsh</a></span></div></div><div class="sidebar-item sidebar-toc"><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#org-journal>Org Journal</a></li><li><a href=#scratching-an-itch>Scratching An Itch</a></li><li><a href=#elisp-to-the-rescue>Elisp to the Rescue</a><ul><li><a href=#what-was-yesterday>What Was Yesterday</a></li><li><a href=#grab-the-tasks>Grab The Tasks</a></li><li><a href=#generating-the-message>Generating The Message</a></li></ul></li><li><a href=#future-expansion>Future Expansion</a></li></ul></nav></div></aside></div><div class=btn><div class=btn-menu id=btn-menu><i class="iconfont icon-grid-sharp"></i></div><div class=btn-toggle-mode><i class="iconfont icon-contrast-sharp"></i></div><div class=btn-scroll-top><i class="iconfont icon-chevron-up-circle-sharp"></i></div></div><aside class=sidebar-mobile style=display:none><div class=sidebar-wrapper><div class="sidebar-item sidebar-pages"><h3>Pages</h3><ul><li><a href=https://cupfullofcode.com/>Home</a></li><li><a href=https://cupfullofcode.com/about/>About</a></li><li><a href=https://cupfullofcode.com/blog/>Blog</a></li><li><a href=https://cupfullofcode.com/search/>Search</a></li><li><a href=https://cupfullofcode.com/index.xml>RSS</a></li></ul></div><div class="sidebar-item sidebar-links"><h3>Links</h3><ul><li><a href=https://github.com/keelerm84 target=_blank><span>GitHub</span></a></li><li><a href=https://twitter.com/keelerm84 target=_blank><span>Twitter</span></a></li></ul></div><div class="sidebar-item sidebar-tags"><h3>Tags</h3><div><span><a href=https://cupfullofcode.com/tags/automation/>automation</a></span>
<span><a href=https://cupfullofcode.com/tags/devops/>devops</a></span>
<span><a href=https://cupfullofcode.com/tags/elisp/>elisp</a></span>
<span><a href=https://cupfullofcode.com/tags/emacs/>emacs</a></span>
<span><a href=https://cupfullofcode.com/tags/github/>github</a></span>
<span><a href=https://cupfullofcode.com/tags/hugo/>hugo</a></span>
<span><a href=https://cupfullofcode.com/tags/logic/>logic</a></span>
<span><a href=https://cupfullofcode.com/tags/org-mode/>org-mode</a></span>
<span><a href=https://cupfullofcode.com/tags/php/>php</a></span>
<span><a href=https://cupfullofcode.com/tags/projectile/>projectile</a></span>
<span><a href=https://cupfullofcode.com/tags/refactoring/>refactoring</a></span>
<span><a href=https://cupfullofcode.com/tags/screen/>screen</a></span>
<span><a href=https://cupfullofcode.com/tags/snippets/>snippets</a></span>
<span><a href=https://cupfullofcode.com/tags/utilities/>utilities</a></span>
<span><a href=https://cupfullofcode.com/tags/vim/>vim</a></span>
<span><a href=https://cupfullofcode.com/tags/zsh/>zsh</a></span></div></div><div class="sidebar-item sidebar-toc"><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#org-journal>Org Journal</a></li><li><a href=#scratching-an-itch>Scratching An Itch</a></li><li><a href=#elisp-to-the-rescue>Elisp to the Rescue</a><ul><li><a href=#what-was-yesterday>What Was Yesterday</a></li><li><a href=#grab-the-tasks>Grab The Tasks</a></li><li><a href=#generating-the-message>Generating The Message</a></li></ul></li><li><a href=#future-expansion>Future Expansion</a></li></ul></nav></div></div></aside></main><footer><div class="container-lg clearfix"><div class="col-12 footer"><span>&copy; 2022
<a href=https://cupfullofcode.com>Matthew M. Keeler</a>
| <a href=https://github.com/keelerm84/cupfullofcode.com>Source code</a>
| Powered by <a href=https://github.com/dsrkafuu/hugo-theme-fuji/ target=_blank>Fuji-v2</a> & <a href=https://gohugo.io/ target=_blank>Hugo</a></span></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.27.0/components/prism-core.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.27.0/plugins/autoloader/prism-autoloader.min.js></script>
<script defer src=https://cupfullofcode.com/assets/js/fuji.min.js></script></body></html>