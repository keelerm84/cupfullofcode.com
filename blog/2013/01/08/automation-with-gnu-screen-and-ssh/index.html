<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Automation with GNU Screen and SSH | Cup Full of Code</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <link rel="alternative" href="/atom.xml" title="Cup Full of Code" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
    <script src="/js/jquery.min.js" type="text/javascript"></script>

    <script src="/js/jquery.dropotron.min.js" type="text/javascript"></script>

    <script src="/js/skel.min.js" type="text/javascript"></script>

    <script src="/js/skel-layers.min.js" type="text/javascript"></script>

    <script src="/js/init.js" type="text/javascript"></script>

    <noscript>
        <link rel="stylesheet" href="/css/skel.css" type="text/css">

        <link rel="stylesheet" href="/css/style.css" type="text/css">

        <link rel="stylesheet" href="/css/style-desktop.css" type="text/css">

    </noscript>
    <!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
</head>

<body class="no-sidebar">
  <div id="container">
    <div id="wrap">
      <div id="header-wrapper" class="wrapper">
    <div id="header">

        <!-- Logo -->
        <div id="logo">
            <h1><a href="index.html">Cup Full of Code</a></h1>
            <p>The personal site of Matthew M. Keeler</p>
        </div>

        <!-- Nav -->
        <nav id="nav">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/portfolio">Portfolio</a></li>
                <li><a href="/resume">Resume</a></li>
                <li><a href="/archives">Blog</a></li>
            </ul>
        </nav>

    </div>
</div>

      <div class="outer">
        <section><div class="wrapper style2">
    <div class="section-title">
        <a href="/blog/2013/01/08/automation-with-gnu-screen-and-ssh/" class="article-date">
  <time datetime="2013-01-08T18:38:00.000Z" itemprop="datePublished">Jan 8 2013</time>
</a>
    </div>
    <div id="main" class="container">
        <article id="post-automation-with-gnu-screen-and-ssh" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
            
  
    <h1 class="article-title" itemprop="name">
      Automation with GNU Screen and SSH
    </h1>
  

        </header>
    
        <div class="article-entry" itemprop="articleBody">
            
                <p>As a developer, I tend to prefer automation whenever possible. Hours of your
life are lost in the minutes spent doing that which could easily be
scripted. The classic rule of thumb I try to follow is &quot;if you have to do it
twice, automate it.&quot;<a id="more"></a></p>
<p>At my job, I have to maintain multiple versions of the product, each of which
are hosted on different virtual machines. When I am ready to start work on a
new feature to an existing version, I have to fire up my code editor, connect
multiple terminals to the system so I can tail various log files, and open a
shell for git. As one can imagine, this is rather time consuming. There is
simply no way I&#39;m doing this by hand every day. To address this, I use a
combination of SSH keys and configs, GNU screen and a small alias.</p>
<p>There are tons of documentation on the web about the use of SSH keys and config
files. If you are unfamiliar with these topics, you can read about SSH keys at
<a href="http://paulkeck.com/ssh/" target="_blank" rel="external">http://paulkeck.com/ssh/</a> and config files at
<a href="http://nerderati.com/2011/03/simplify-your-life-with-an-ssh-config-file/" target="_blank" rel="external">http://nerderati.com/2011/03/simplify-your-life-with-an-ssh-config-file/</a>. Since
the main purpose is to show how my tools fit together, I&#39;ll just state that
every virtual server I connect to has a copy of my SSH key, and that I have a
config file defined with an example snippet shown below:</p>
<figure class="highlight sh"><pre><div class="line">Host <span class="number">19</span></div><div class="line">HostName <span class="number">19</span>.virtualserver</div><div class="line">Port <span class="number">12345</span></div><div class="line">User developer</div></pre></figure>

<p>Each host corresponds to a server hosting a specific version, so instead of
issuing ssh -p12345 developer@19.virtualserver, I can simply type ssh 19. With
the added bonus SSH keys bring to the party, connecting is quick and
simple. But what about all those connections I mentioned earlier?</p>
<p>While it is true I could open multiple terminal tabs, I actually prefer to work
within <a href="http://www.gnu.org/software/screen/" target="_blank" rel="external">GNU Screen</a>. Once again, the
details of using screen are outside the scope of this entry, but check out this
post
<a href="http://www.kuro5hin.org/story/2004/3/9/16838/14935" target="_blank" rel="external">http://www.kuro5hin.org/story/2004/3/9/16838/14935</a>
for some general information.</p>
<p>One thing you don&#39;t hear a lot about is scripting with screen. With the
powerful options provided, you can easily start a screen, launch multiple named
tabs, and execute any command of your choosing. I have a screen config for each
product version I manage. Version 1.9&#39;s config is shown below:</p>
<figure class="highlight sh"><pre><div class="line"><span class="comment"># Start screen in detached mode (-d -m), and give it a session name ('1-9') to avoid</span></div><div class="line"><span class="comment"># confusion when communicating with this session later as we add commands</span></div><div class="line">screen <span class="operator">-d</span> -m -S <span class="number">1</span>-<span class="number">9</span></div><div class="line"></div><div class="line"><span class="comment"># Run a command in the current screen window (edit some file for example)</span></div><div class="line">screen -S <span class="number">1</span>-<span class="number">9</span> -p <span class="number">0</span> -X title Git</div><div class="line"></div><div class="line"><span class="comment"># Create a new window, and run a command in that window:</span></div><div class="line">screen -S <span class="number">1</span>-<span class="number">9</span> -p <span class="number">0</span> -X screen -t Code emacsclient -nw -c</div><div class="line">screen -S <span class="number">1</span>-<span class="number">9</span> -p <span class="number">0</span> -X screen -t Application ssh <span class="number">19</span> <span class="string">'tail -F /var/www/product/logs/error.log'</span></div><div class="line">screen -S <span class="number">1</span>-<span class="number">9</span> -p <span class="number">0</span> -X screen -t Apache ssh <span class="number">19</span> <span class="string">'tail -F /var/log/httpd/error.log'</span></div><div class="line">screen -S <span class="number">1</span>-<span class="number">9</span> -p <span class="number">0</span> -X screen -t Remote ssh <span class="number">19</span></div></pre></figure>

<p>Executing this script will create a new screen session with five tabs, giving
me a tab for git, one for my editor of choice, two actively tailing various log
files, and a third connected to the remote system so I can easily navigate and
check out other bits of the system as needed. This script relies heavily on my
aforementioned use of SSH configs and keys. With the keys copied over, I don&#39;t
have to provide a password for the three tabs that connect to the development
box. And if any of the connection details for any of the virtual machines
change, I don&#39;t have to touch this script, and can instead make the
modification in one place.</p>
<p>And finally, just to prevent a few more keystrokes, I also have defined aliases
in my .alias file like the following:</p>
<figure class="highlight sh"><pre><div class="line">alias <span class="string">'19'</span>=<span class="string">'cd ~/Projects/version19; ~/.screen.d/1.9 &amp;&amp; screen -r 1-9'</span></div></pre></figure>

<p>Now, when I&#39;m ready to go to work, I simply open a terminal, type 19, and I&#39;m
automatically thrown into screen, running the applications and viewing the logs
that I almost always need, ready to hit the ground coding with absolute minimal
effort.</p>

        
        </div>
    </div>
</article>

<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>


    </div>
</div>
</section>
      </div>
      <!-- Footer -->
<div id="footer-wrapper" class="wrapper">
    <div class="section-title">Links of interest</div>
    <div id="footer" class="container">
        <div class="row oneandhalf">
            <div class="12u">

                <section class="feature-list small">
                    <div class="row">
                        <div class="3u">
                            <section>
                                <h3 class="icon fa-envelope">Email</h3>
                                <p>
                                <a href="#">keelerm@tortugas-llc.com</a>
                                </p>
                            </section>
                            <section>
                                <h3 class="icon fa-rss">Subscribe</h3>
                                <p>
                                <a href="/atom.xml">Atom Feed</a>
                                </p>
                            </section>
                        </div>
                        <div class="3u">
                            <section>
                                <h3 class="icon fa-comment">Social</h3>
                                <p>
                                <a href="#">@keelerm84</a><br />
                                <a href="#">github.com/keelerm84</a><br />
                                <a href="#">youtube.com/user/keelerm84ify</a>
                                </p>
                            </section>
                        </div>
                        <div class="3u">
                            <section>
                                <h3 class="icon fa-tag">Tags</h3>
                                
  <div class="widget-wrap">
    <p>
    <a class="tag-link" href="/tags/automation/">automation</a>, <a class="tag-link" href="/tags/elisp/">elisp</a>, <a class="tag-link" href="/tags/emacs/">emacs</a>, <a class="tag-link" href="/tags/logic/">logic</a>, <a class="tag-link" href="/tags/org-mode/">org-mode</a>, <a class="tag-link" href="/tags/php/">php</a>, <a class="tag-link" href="/tags/projectile/">projectile</a>, <a class="tag-link" href="/tags/refactoring/">refactoring</a>, <a class="tag-link" href="/tags/screen/">screen</a>, <a class="tag-link" href="/tags/snippets/">snippets</a>, <a class="tag-link" href="/tags/utilities/">utilities</a>, <a class="tag-link" href="/tags/vim/">vim</a>, <a class="tag-link" href="/tags/zsh/">zsh</a>
    </p>
  </div>


                            </section>
                        </div>
                        <div class="3u">
                            <section>
                                <h3 class="icon fa-folder-open">Categories</h3>
                                
    <p>
    <a class="category-link" href="/categories/Emacs/">Emacs</a>, <a class="category-link" href="/categories/Emacs/PHP/">PHP</a>, <a class="category-link" href="/categories/Programming/">Programming</a>, <a class="category-link" href="/categories/Utilities/">Utilities</a>
    </p>


                            </section>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        <hr />
        <header class="style1">
            <h2>There is no system but GNU, and Linux is one of its kernels.</h2>
            <p>&mdash; St. IGNUcius</p>
        </header>
    </div>
</div>

    </div>
    
<script>
  var disqus_shortname = 'cupfullofcode';
  
  var disqus_url = 'http://cupfullofcode.com/blog/2013/01/08/automation-with-gnu-screen-and-ssh/';
  
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55725869-1', 'auto');
  ga('send', 'pageview');

</script>
  </div>
</body>
</html>
