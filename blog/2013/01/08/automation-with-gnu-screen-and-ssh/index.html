<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=HandheldFriendly content="True"><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=generator content="Hugo 0.98.0"><link rel="shortcut icon" href=https://cdn.jsdelivr.net/gh/dsrkafuu/dsr-cdn-main@1/images/favicons/dsrca.ico><title>Automation with GNU Screen and SSH - Cup Full of Code</title><meta name=author content="Matthew M. Keeler"><meta name=description content="Basic scripting of GNU screen with ssh connections"><meta name=keywords content="utilities,screen,automation"><meta property="og:title" content="Automation with GNU Screen and SSH"><meta name=twitter:title content="Automation with GNU Screen and SSH"><meta property="og:type" content="article"><meta property="og:url" content="https://cupfullofcode.com/blog/2013/01/08/automation-with-gnu-screen-and-ssh/"><meta property="og:description" content="Basic scripting of GNU screen with ssh connections"><meta name=twitter:description content="Basic scripting of GNU screen with ssh connections"><meta name=twitter:card content="summary"><meta property="article:published_time" content="2013-01-08T13:38:00+00:00"><meta property="article:modified_time" content="2013-01-08T13:38:00+00:00"><style>@media(prefers-color-scheme:dark){body[data-theme=auto] img{filter:brightness(60%)}}body[data-theme=dark] img{filter:brightness(60%)}</style><link rel=stylesheet href=https://cupfullofcode.com/assets/css/fuji.min.css><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-55725869-1")</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-55725869-1"></script></head><body data-theme=auto data-theme-auto=false><script data-cfasync=false>var fujiThemeData=localStorage.getItem("fuji_data-theme");fujiThemeData?fujiThemeData!=="auto"&&document.body.setAttribute("data-theme",fujiThemeData==="dark"?"dark":"light"):localStorage.setItem("fuji_data-theme","auto")</script><header><div class="container-lg clearfix"><div class="col-12 header"><a class=title-main href=https://cupfullofcode.com>Cup Full of Code</a>
<span class=title-sub>The personal site of Matthew M. Keeler</span></div></div></header><main><div class="container-lg clearfix"><div class="col-12 col-md-9 float-left content"><article><h2 class="post-item post-title"><a href=https://cupfullofcode.com/blog/2013/01/08/automation-with-gnu-screen-and-ssh/>Automation with GNU Screen and SSH</a></h2><div class="post-item post-meta"><span><i class="iconfont icon-today-sharp"></i>&nbsp;2013-01-08</span>
<span><i class="iconfont icon-file-tray-sharp"></i>&nbsp;685 words</span>
<span><i class="iconfont icon-time-sharp"></i>&nbsp;4 minutes</span>
<span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href=https://cupfullofcode.com/tags/utilities>utilities</a>&nbsp;<a href=https://cupfullofcode.com/tags/screen>screen</a>&nbsp;<a href=https://cupfullofcode.com/tags/automation>automation</a>&nbsp;</span></div><div class="post-content markdown-body"><p>As a developer, I tend to prefer automation whenever possible. Hours of your
life are lost in the minutes spent doing that which could easily be
scripted. The classic rule of thumb I try to follow is &ldquo;if you have to do it
twice, automate it.&rdquo;</p><p>At my job, I have to maintain multiple versions of the product, each of which
are hosted on different virtual machines. When I am ready to start work on a
new feature to an existing version, I have to fire up my code editor, connect
multiple terminals to the system so I can tail various log files, and open a
shell for git. As one can imagine, this is rather time consuming. There is
simply no way I&rsquo;m doing this by hand every day. To address this, I use a
combination of SSH keys and configs, GNU screen and a small alias.</p><p>There are tons of documentation on the web about the use of SSH keys and config
files. If you are unfamiliar with these topics, you can read about SSH keys at
<a href=http://paulkeck.com/ssh/ target=_blank>http://paulkeck.com/ssh/</a> and config files at
<a href=http://nerderati.com/2011/03/simplify-your-life-with-an-ssh-config-file/ target=_blank>http://nerderati.com/2011/03/simplify-your-life-with-an-ssh-config-file/</a>. Since
the main purpose is to show how my tools fit together, I&rsquo;ll just state that
every virtual server I connect to has a copy of my SSH key, and that I have a
config file defined with an example snippet shown below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Host <span style=color:#ae81ff>19</span>
</span></span><span style=display:flex><span>HostName 19.virtualserver
</span></span><span style=display:flex><span>Port <span style=color:#ae81ff>12345</span>
</span></span><span style=display:flex><span>User developer</span></span></code></pre></div><p>Each host corresponds to a server hosting a specific version, so instead of
issuing ssh -p12345 <a href=mailto:developer@19.virtualserver>developer@19.virtualserver</a>, I can simply type ssh 19. With
the added bonus SSH keys bring to the party, connecting is quick and
simple. But what about all those connections I mentioned earlier?</p><p>While it is true I could open multiple terminal tabs, I actually prefer to work
within <a href=http://www.gnu.org/software/screen/ target=_blank>GNU Screen</a>. Once again, the
details of using screen are outside the scope of this entry, but check out this
post
<a href=http://www.kuro5hin.org/story/2004/3/9/16838/14935 target=_blank>http://www.kuro5hin.org/story/2004/3/9/16838/14935</a>
for some general information.</p><p>One thing you don&rsquo;t hear a lot about is scripting with screen. With the
powerful options provided, you can easily start a screen, launch multiple named
tabs, and execute any command of your choosing. I have a screen config for each
product version I manage. Version 1.9&rsquo;s config is shown below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Start screen in detached mode (-d -m), and give it a session name (&#39;1-9&#39;) to avoid</span>
</span></span><span style=display:flex><span><span style=color:#75715e># confusion when communicating with this session later as we add commands</span>
</span></span><span style=display:flex><span>screen -d -m -S 1-9
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Run a command in the current screen window (edit some file for example)</span>
</span></span><span style=display:flex><span>screen -S 1-9 -p <span style=color:#ae81ff>0</span> -X title Git
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create a new window, and run a command in that window:</span>
</span></span><span style=display:flex><span>screen -S 1-9 -p <span style=color:#ae81ff>0</span> -X screen -t Code emacsclient -nw -c
</span></span><span style=display:flex><span>screen -S 1-9 -p <span style=color:#ae81ff>0</span> -X screen -t Application ssh <span style=color:#ae81ff>19</span> <span style=color:#e6db74>&#39;tail -F /var/www/product/logs/error.log&#39;</span>
</span></span><span style=display:flex><span>screen -S 1-9 -p <span style=color:#ae81ff>0</span> -X screen -t Apache ssh <span style=color:#ae81ff>19</span> <span style=color:#e6db74>&#39;tail -F /var/log/httpd/error.log&#39;</span>
</span></span><span style=display:flex><span>screen -S 1-9 -p <span style=color:#ae81ff>0</span> -X screen -t Remote ssh <span style=color:#ae81ff>19</span></span></span></code></pre></div><p>Executing this script will create a new screen session with five tabs, giving
me a tab for git, one for my editor of choice, two actively tailing various log
files, and a third connected to the remote system so I can easily navigate and
check out other bits of the system as needed. This script relies heavily on my
aforementioned use of SSH configs and keys. With the keys copied over, I don&rsquo;t
have to provide a password for the three tabs that connect to the development
box. And if any of the connection details for any of the virtual machines
change, I don&rsquo;t have to touch this script, and can instead make the
modification in one place.</p><p>And finally, just to prevent a few more keystrokes, I also have defined aliases
in my .alias file like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>alias <span style=color:#e6db74>&#39;19&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;cd ~/Projects/version19; ~/.screen.d/1.9 &amp;&amp; screen -r 1-9&#39;</span></span></span></code></pre></div><p>Now, when I&rsquo;m ready to go to work, I simply open a terminal, type 19, and I&rsquo;m
automatically thrown into screen, running the applications and viewing the logs
that I almost always need, ready to hit the ground coding with absolute minimal
effort.</p></div></article></div><aside class="col-12 col-md-3 float-left sidebar"><div class="sidebar-item sidebar-pages"><h3>Pages</h3><ul><li><a href=https://cupfullofcode.com/>Home</a></li><li><a href=https://cupfullofcode.com/about/>About</a></li><li><a href=https://cupfullofcode.com/blog/>Blog</a></li><li><a href=https://cupfullofcode.com/search/>Search</a></li><li><a href=https://cupfullofcode.com/index.xml>RSS</a></li></ul></div><div class="sidebar-item sidebar-links"><h3>Links</h3><ul><li><a href=https://github.com/keelerm84 target=_blank><span>GitHub</span></a></li><li><a href=https://twitter.com/keelerm84 target=_blank><span>Twitter</span></a></li></ul></div><div class="sidebar-item sidebar-tags"><h3>Tags</h3><div><span><a href=https://cupfullofcode.com/tags/automation/>automation</a></span>
<span><a href=https://cupfullofcode.com/tags/devops/>devops</a></span>
<span><a href=https://cupfullofcode.com/tags/elisp/>elisp</a></span>
<span><a href=https://cupfullofcode.com/tags/emacs/>emacs</a></span>
<span><a href=https://cupfullofcode.com/tags/github/>github</a></span>
<span><a href=https://cupfullofcode.com/tags/hugo/>hugo</a></span>
<span><a href=https://cupfullofcode.com/tags/logic/>logic</a></span>
<span><a href=https://cupfullofcode.com/tags/org-mode/>org-mode</a></span>
<span><a href=https://cupfullofcode.com/tags/php/>php</a></span>
<span><a href=https://cupfullofcode.com/tags/projectile/>projectile</a></span>
<span><a href=https://cupfullofcode.com/tags/refactoring/>refactoring</a></span>
<span><a href=https://cupfullofcode.com/tags/screen/>screen</a></span>
<span><a href=https://cupfullofcode.com/tags/snippets/>snippets</a></span>
<span><a href=https://cupfullofcode.com/tags/utilities/>utilities</a></span>
<span><a href=https://cupfullofcode.com/tags/vim/>vim</a></span>
<span><a href=https://cupfullofcode.com/tags/zsh/>zsh</a></span></div></div><div class="sidebar-item sidebar-toc"><h3>Table of Contents</h3><nav id=TableOfContents></nav></div></aside></div><div class=btn><div class=btn-menu id=btn-menu><i class="iconfont icon-grid-sharp"></i></div><div class=btn-toggle-mode><i class="iconfont icon-contrast-sharp"></i></div><div class=btn-scroll-top><i class="iconfont icon-chevron-up-circle-sharp"></i></div></div><aside class=sidebar-mobile style=display:none><div class=sidebar-wrapper><div class="sidebar-item sidebar-pages"><h3>Pages</h3><ul><li><a href=https://cupfullofcode.com/>Home</a></li><li><a href=https://cupfullofcode.com/about/>About</a></li><li><a href=https://cupfullofcode.com/blog/>Blog</a></li><li><a href=https://cupfullofcode.com/search/>Search</a></li><li><a href=https://cupfullofcode.com/index.xml>RSS</a></li></ul></div><div class="sidebar-item sidebar-links"><h3>Links</h3><ul><li><a href=https://github.com/keelerm84 target=_blank><span>GitHub</span></a></li><li><a href=https://twitter.com/keelerm84 target=_blank><span>Twitter</span></a></li></ul></div><div class="sidebar-item sidebar-tags"><h3>Tags</h3><div><span><a href=https://cupfullofcode.com/tags/automation/>automation</a></span>
<span><a href=https://cupfullofcode.com/tags/devops/>devops</a></span>
<span><a href=https://cupfullofcode.com/tags/elisp/>elisp</a></span>
<span><a href=https://cupfullofcode.com/tags/emacs/>emacs</a></span>
<span><a href=https://cupfullofcode.com/tags/github/>github</a></span>
<span><a href=https://cupfullofcode.com/tags/hugo/>hugo</a></span>
<span><a href=https://cupfullofcode.com/tags/logic/>logic</a></span>
<span><a href=https://cupfullofcode.com/tags/org-mode/>org-mode</a></span>
<span><a href=https://cupfullofcode.com/tags/php/>php</a></span>
<span><a href=https://cupfullofcode.com/tags/projectile/>projectile</a></span>
<span><a href=https://cupfullofcode.com/tags/refactoring/>refactoring</a></span>
<span><a href=https://cupfullofcode.com/tags/screen/>screen</a></span>
<span><a href=https://cupfullofcode.com/tags/snippets/>snippets</a></span>
<span><a href=https://cupfullofcode.com/tags/utilities/>utilities</a></span>
<span><a href=https://cupfullofcode.com/tags/vim/>vim</a></span>
<span><a href=https://cupfullofcode.com/tags/zsh/>zsh</a></span></div></div><div class="sidebar-item sidebar-toc"><h3>Table of Contents</h3><nav id=TableOfContents></nav></div></div></aside></main><footer><div class="container-lg clearfix"><div class="col-12 footer"><span>&copy; 2024
<a href=https://cupfullofcode.com>Matthew M. Keeler</a>
| <a href=https://github.com/keelerm84/cupfullofcode.com>Source code</a>
| Powered by <a href=https://github.com/dsrkafuu/hugo-theme-fuji/ target=_blank>Fuji-v2</a> & <a href=https://gohugo.io/ target=_blank>Hugo</a></span></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.27.0/components/prism-core.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.27.0/plugins/autoloader/prism-autoloader.min.js></script>
<script defer src=https://cupfullofcode.com/assets/js/fuji.min.js></script></body></html>